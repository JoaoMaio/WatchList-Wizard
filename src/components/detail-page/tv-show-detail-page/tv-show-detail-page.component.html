<div *ngIf="!isLoading" class="page">
  <div class="card">
    <div class="backdrop">
      <img *ngIf="api.doesBackDropExist(tvshow .backdrop_path)" src="{{backdropPath + tvshow .backdrop_path}}" alt="backdrop" />
      <img *ngIf="!api.doesBackDropExist(tvshow .backdrop_path)" src="404.png" alt="backdrop" class="error_image" />
      <div class="title_checkmark">
        <div class="info">
          <h1 class="title">{{ tvshow .name }}</h1>
          <div class="countSeasons_RunTime">
            <span *ngIf="tvshow .number_of_seasons === 1">{{ tvshow .number_of_seasons }} Season</span>
            <span *ngIf="tvshow .number_of_seasons! > 1">{{ tvshow .number_of_seasons }} Seasons</span>
            <div class="rating">
              <div class="rating_inside">
                <span class="badge"
                  [ngClass]="{
                    'badge-success': tvshow .vote_average! >= 8,
                    'badge-warning': tvshow .vote_average! < 8 && tvshow .vote_average! >= 5,
                    'badge-danger': tvshow .vote_average! < 5
                  }">
                  {{ generateOpinion(tvshow .vote_average!) }} - {{ tvshow .vote_average .toPrecision(3) }} / 10
                </span>
              </div>
            </div>
          </div>
        </div>
          <div class="markAsWatchedTitle">
            <button *ngIf="!isOnWatchList" (click)="addShowToWatchList()" class="markAsWatchedbutton">
              +
            </button>
            <button *ngIf="isOnWatchList" (click)="removeShowsFromWatchList()" class="markAsWatchedbutton watched">
              ✓
            </button>
          </div>
      </div>

    </div>
  </div>

  <div class="content">
    <div class="tvshow_info">
      <div class="overview-container">
        <p class="overview" [ngClass]="{ 'expanded': isOverviewExpanded }">{{ tvshow.overview }}</p>
        <button class="toggle-button" (click)="isOverviewExpanded = !isOverviewExpanded">
          {{ isOverviewExpanded  ? 'Show Less' : 'Show More' }}
        </button>
      </div>

      <div class="divider"></div>

      <p class="section_title">Genres:</p>
      <div class="genres" *ngIf="tvshow .genres">
        <span *ngFor="let genre of tvshow .genres">{{ genre.name }}</span>
      </div>

      <div class="divider"></div>

      <div class="providers_section" *ngIf="tvshow .watch_providers!.length > 0">
        <p class="section_title">Watch on:</p>
        <div class="providers">
          <span *ngFor="let provider of tvshow .watch_providers">
            <img src="{{ imgPath + provider.logo_path }}" alt="{{ provider.provider_name }}" />
            <p>{{ provider.provider_name }}</p>
          </span>
        </div>
      </div>

      <div class="divider"></div>

      <p class="section_title">Continue to Watch:</p>

      <div class="episode-details" *ngIf="nextEpisode" >
        <div class="image_container">
          <img *ngIf="api.doesBackDropExist(nextEpisode.still_path)" src="{{ imgPath + nextEpisode.still_path }}" alt="episode still" />
          <img *ngIf="!api.doesBackDropExist(nextEpisode.still_path)" src="tba.png" alt="to be announced" />
        </div>
        <div class="text_container">
          <p class="episode-title">Episode {{ nextEpisode.episode_number }} - {{ nextEpisode.name }}</p>
        </div>
        <div class="markAsWatched" *ngIf="api.doesBackDropExist(nextEpisode.still_path)">
          <button *ngIf="!nextEpisode.watched" (click)="markEpisodeAsWatched(nextEpisode)" class="markAsWatchedbutton">
            +
          </button>
          <button *ngIf="nextEpisode.watched" (click)="markEpisodeAsUnWatched(nextEpisode)" class="markAsWatchedbutton watched">
            ✓
          </button>
        </div>
        <div class="tba_days" *ngIf="!api.doesBackDropExist(nextEpisode.still_path)">
            <p>{{shows_api.getDaysUntiItsOut(nextEpisode)}} days </p>
        </div>
      </div>

      <div class="divider"></div>

      <div class="seasons">
        <div *ngFor="let season of seasons">
          <app-custom-expansion-panel
            [title]="'Season ' + season.season_number"
            [season]="season"
            [tvshow]="tvshow"
            [isOnWatchList]="isOnWatchList"
            (addOrRemoveEpisode)="onAddOrRemoveEpisode()"
            (addedShow)="onAddedShow()"
          >
          </app-custom-expansion-panel>
        </div>
      </div>
    </div>

  </div>
</div>


<!-- Optionally handle loading state -->
<div class="loading-container" *ngIf="isLoading">
  <div class="cube-loader">
    <div class="cube"></div>
    <div class="cube"></div>
    <div class="cube"></div>
    <div class="cube"></div>
  </div>
</div>
